<!DOCTYPE html>
<html lang="id">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Survey 100 - Individual Mode</title>
    <style>
        /* General Setup & Font */
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap');

        :root {
            --primary-bg: #1a237e;
            /* Deep Blue */
            --secondary-bg: #283593;
            /* Lighter Blue */
            --accent-color: #ffab40;
            /* Orange Accent */
            --text-light: #ffffff;
            --text-dark: #333;
            --warning-color: #fbc02d;
            /* Yellow for Undo */
            --success-color: #4caf50;
            /* Green for success */
            --gold-color: #ffd700;
            --silver-color: #c0c0c0;
            --bronze-color: #cd7f32;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        html,
        body {
            height: 100%;
            width: 100%;
            font-family: 'Poppins', sans-serif;
            background-image: url('images/Background.png');
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            color: var(--text-light);
            overflow: hidden;
        }

        .screen {
            width: 100%;
            height: 100%;
            padding: 1rem;
            position: absolute;
            top: 0;
            left: 0;
            transition: opacity 0.5s ease-in-out, transform 0.5s ease-in-out;
            display: none;
            /* Sembunyikan semua layar secara default */
        }

        #setup-screen.active,
        #winner-screen.active {
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        /* --- LAYOUT FIX: Menggunakan Flexbox untuk Stabilitas --- */
        #game-screen.active {
            display: flex;
            flex-direction: column;
        }

        h1,
        h2,
        h3 {
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }

        button {
            font-family: 'Poppins', sans-serif;
            font-weight: 600;
            padding: 0.8rem 1.5rem;
            border: none;
            border-radius: 8px;
            background-color: var(--accent-color);
            color: var(--text-dark);
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.2);
            font-size: 1.1rem;
        }

        button:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 6px 8px rgba(0, 0, 0, 0.3);
        }

        button:disabled {
            background-color: #9e9e9e;
            cursor: not-allowed;
            opacity: 0.7;
        }

        input[type="text"],
        input[type="number"],
        textarea {
            font-family: 'Poppins', sans-serif;
            padding: 0.7rem;
            border: 2px solid var(--secondary-bg);
            border-radius: 8px;
            background-color: #fff;
            color: var(--text-dark);
            font-size: 1rem;
            width: 100%;
        }

        /* --- LAYAR 1: SETUP SCREEN --- */
        #setup-screen {
            justify-content: flex-start;
            overflow-y: auto;
            gap: 1.5rem;
        }

        #setup-form {
            width: 100%;
            max-width: 800px;
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
        }

        #player-setup-container {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        #player-names {
            min-height: 120px;
            resize: vertical;
        }

        #rounds-container {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .round-editor {
            background-color: var(--secondary-bg);
            padding: 1.5rem;
            border-radius: 12px;
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.2);
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .answers-editor {
            display: grid;
            grid-template-columns: 1fr 100px;
            gap: 0.5rem 1rem;
        }

        .delete-round-btn {
            background-color: #d32f2f;
            color: var(--text-light);
            align-self: flex-end;
        }

        /* --- LAYAR 2: GAME SCREEN (LAYOUT BARU) --- */
        #game-screen {
            gap: 1rem;
            height: 100%;
        }

        #leaderboard-container {
            flex-shrink: 0;
            /* Jangan sampai tertekan */
            display: flex;
            align-items: center;
            gap: 0.5rem;
            width: 100%;
            min-height: 80px;
        }

        .scroll-btn {
            background-color: var(--secondary-bg);
            color: var(--text-light);
            border: 1px solid var(--primary-bg);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            font-size: 1.5rem;
            cursor: pointer;
            z-index: 10;
            flex-shrink: 0;
            display: none;
            /* Sembunyikan by default */
        }

        #player-leaderboard {
            background-color: rgba(0, 0, 0, 0.2);
            padding: 0.5rem 1rem;
            border-radius: 12px;
            display: flex;
            gap: 1rem;
            align-items: center;
            flex-grow: 1;
            flex-wrap: nowrap;
            overflow-x: auto;
            scroll-behavior: smooth;
            scrollbar-width: none;
            /* Firefox */
            -ms-overflow-style: none;
            /* IE and Edge */
        }

        #player-leaderboard::-webkit-scrollbar {
            display: none;
        }

        .player-card {
            background-color: var(--secondary-bg);
            padding: 0.5rem 1rem;
            border-radius: 8px;
            display: flex;
            gap: 0.5rem;
            align-items: center;
            transition: all 0.3s ease;
            min-width: 180px;
            flex-shrink: 0;
            border: 2px solid transparent;
        }

        .player-card.highlight {
            transform: scale(1.05);
            box-shadow: 0 0 15px var(--accent-color);
            background-color: var(--success-color);
        }

        .player-name {
            font-weight: 600;
            font-size: 1rem;
        }

        .player-score {
            font-size: 1.2rem;
            font-weight: 700;
            color: var(--accent-color);
            cursor: pointer;
            transition: color 0.2s;
            margin-left: auto;
        }

        .player-score:hover {
            color: #fff;
        }

        /* --- PODIUM STYLES --- */
        .player-card.rank-1 {
            border-color: var(--gold-color);
            transform: scale(1.1);
            box-shadow: 0 0 15px var(--gold-color);
        }

        .player-card.rank-2 {
            border-color: var(--silver-color);
            transform: scale(1.05);
        }

        .player-card.rank-3 {
            border-color: var(--bronze-color);
        }

        .player-card.rank-other {
            opacity: 0.7;
            transform: scale(0.9);
        }

        .player-rank {
            font-size: 1.2rem;
        }

        .game-main-area {
            flex-grow: 1;
            /* Ambil sisa ruang */
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 1rem;
            min-height: 0;
        }

        #round-display {
            font-size: 1.8rem;
        }

        #topic-display {
            font-size: 1.8rem;
            opacity: 0.9;
            font-weight: 600;
            text-align: center;
            max-width: 90%;
            padding: 1rem;
            background-color: rgba(0, 0, 0, 0.2);
            border-radius: 10px;
            min-height: 100px;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 100%;
        }

        #main-board {
            width: 100%;
            flex-grow: 1;
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1rem;
            perspective: 1000px;
            overflow-y: auto;
            padding: 0.5rem;
        }

        /* Flip Card Animation */
        .answer-slot {
            background-color: transparent;
            min-height: 80px;
            border-radius: 10px;
            cursor: pointer;
            position: relative;
        }

        .answer-slot-inner {
            position: relative;
            width: 100%;
            height: 100%;
            transition: transform 0.6s;
            transform-style: preserve-3d;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            border-radius: 10px;
        }

        .answer-slot.revealed .answer-slot-inner {
            transform: rotateY(180deg);
        }

        .answer-front,
        .answer-back {
            position: absolute;
            width: 100%;
            height: 100%;
            -webkit-backface-visibility: hidden;
            backface-visibility: hidden;
            display: flex;
            align-items: center;
            justify-content: space-between;
            border-radius: 10px;
            font-size: 1.2rem;
            font-weight: 600;
            padding: 0 1rem;
        }

        .answer-front {
            background: linear-gradient(145deg, var(--secondary-bg), #1e2a8a);
            justify-content: center;
        }

        .answer-back {
            background-color: #f0f0f0;
            color: var(--text-dark);
            transform: rotateY(180deg);
        }

        .answer-number {
            font-size: 1.8rem;
        }

        .answer-text {
            flex-grow: 1;
            text-align: left;
            padding: 0 1rem;
        }

        .answer-points {
            background: rgba(0, 0, 0, 0.1);
            padding: 0.5rem 1rem;
            border-radius: 6px;
        }

        .host-controls {
            flex-shrink: 0;
            display: flex;
            gap: 1rem;
            align-items: center;
            flex-wrap: wrap;
            justify-content: center;
        }

        #reveal-all-btn {
            background-color: var(--success-color);
            color: white;
        }

        #undo-btn {
            background-color: var(--warning-color);
            display: none;
        }

        /* Sembunyikan secara default */

        /* --- LAYAR 3: WINNER SCREEN --- */
        #winner-screen {
            justify-content: center;
            gap: 1.5rem;
        }

        #winner-announcement {
            font-size: 2.5rem;
            color: var(--accent-color);
            font-weight: 700;
            margin: 1rem 0;
        }

        #final-scores-list {
            list-style: none;
            padding: 0;
            font-size: 1.2rem;
            max-width: 500px;
            width: 100%;
        }

        #final-scores-list li {
            background: rgba(0, 0, 0, 0.2);
            margin-bottom: 0.5rem;
            padding: 0.8rem;
            border-radius: 8px;
            display: flex;
            justify-content: space-between;
        }

        /* --- MODAL STYLES --- */
        .modal {
            position: fixed;
            z-index: 100;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.6);
            display: none;
            justify-content: center;
            align-items: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background-color: var(--secondary-bg);
            padding: 2rem;
            border-radius: 15px;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.5);
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
            max-width: 90%;
            width: 400px;
        }

        .modal-content h2 {
            color: var(--accent-color);
        }

        #award-player-select,
        #edit-score-input {
            width: 100%;
            padding: 0.5rem;
            font-size: 1.1rem;
            border-radius: 5px;
        }

        .modal-buttons {
            display: flex;
            justify-content: center;
            gap: 1rem;
        }
    </style>
</head>

<body>
    <!-- LAYAR 1: SETUP GAME -->
    <div id="setup-screen" class="screen active">
        <h1>Siapkan Pertandingan</h1>
        <form id="setup-form">
            <div id="player-setup-container">
                <label for="player-names">
                    <h3>Nama Pemain (Satu nama per baris)</h3>
                </label>
                <textarea id="player-names" placeholder="Pemain 1&#10;Pemain 2&#10;Pemain 3" required></textarea>
            </div>
            <div id="rounds-container"></div>
            <button type="button" id="add-round-btn">+ Tambah Ronde</button>
            <button type="submit" id="start-game-btn">Mulai Permainan!</button>
        </form>
    </div>

    <!-- LAYAR 2: PAPAN PERMAINAN UTAMA (STRUKTUR HTML BARU) -->
    <div id="game-screen" class="screen">
        <div id="leaderboard-container">
            <button id="scroll-left-btn" class="scroll-btn">&lt;</button>
            <header id="player-leaderboard">
                <!-- Kartu pemain akan diisi oleh JS -->
            </header>
            <button id="scroll-right-btn" class="scroll-btn">&gt;</button>
        </div>
        <div class="game-main-area">
            <h3 id="round-display"></h3>
            <p id="topic-display"></p>
            <main id="main-board"></main>
        </div>
        <footer class="host-controls">
            <button id="undo-btn">Batalkan Aksi</button>
            <button id="reveal-all-btn">Tampilkan Semua Jawaban</button>
            <button id="next-round-btn">Ronde Selanjutnya</button>
            <button id="end-game-btn">Akhiri Permainan</button>
        </footer>
    </div>

    <!-- LAYAR 3: TAMPILAN PEMENANG -->
    <div id="winner-screen" class="screen">
        <h1>GAME CLEAR!</h1>
        <p id="winner-announcement"></p>
        <ul id="final-scores-list"></ul>
        <button id="play-again-btn">Main Lagi?</button>
    </div>

    <!-- MODAL UNTUK MEMBERI POIN -->
    <div id="award-points-modal" class="modal">
        <div class="modal-content">
            <h2>Beri Poin ke Siapa?</h2>
            <select id="award-player-select"></select>
            <div class="modal-buttons">
                <button id="confirm-award-btn">Beri Poin</button>
                <button id="cancel-award-btn">Batal</button>
            </div>
        </div>
    </div>

    <!-- MODAL UNTUK EDIT SKOR MANUAL -->
    <div id="edit-score-modal" class="modal">
        <div class="modal-content">
            <h2 id="edit-score-title">Edit Skor</h2>
            <input type="number" id="edit-score-input">
            <div class="modal-buttons">
                <button id="confirm-edit-btn">Simpan</button>
                <button id="cancel-edit-btn">Batal</button>
            </div>
        </div>
    </div>


    <!-- TEMPLATE UNTUK BLOK RONDE -->
    <template id="round-template">
        <div class="round-editor">
            <input type="text" class="round-topic" placeholder="Topik / Pertanyaan Ronde" required>
            <div class="answers-editor">
                <label>Jawaban</label>
                <label>Poin</label>
            </div>
            <button type="button" class="delete-round-btn">Hapus Ronde Ini</button>
        </div>
    </template>

    <!-- SFX -->
    <audio id="sfx-correct" src="https://www.myinstants.com/media/sounds/correct-answer-new.mp3"></audio>
    <audio id="sfx-reveal" src="https://www.myinstants.com/media/sounds/spiderman-meme-song.mp3"></audio>
    <audio id="sfx-undo" src="https://actions.google.com/sounds/v1/alarms/alarm_clock.ogg"></audio>
    <audio id="sfx-gameover" src="https://www.myinstants.com/media/sounds/gigachad-phonk-house.mp3"></audio>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // --- STATE MANAGEMENT ---
            let gameData = {};
            let activeAward = { answerSlot: null, answerIndex: null, points: 0 };
            let lastAction = null; // Untuk menyimpan aksi terakhir (Undo)
            let playerToEdit = null; // Untuk menyimpan index player yg skornya akan diedit

            // --- DOM ELEMENTS ---
            const screens = { setup: document.getElementById('setup-screen'), game: document.getElementById('game-screen'), winner: document.getElementById('winner-screen') };
            const awardModal = document.getElementById('award-points-modal');
            const editScoreModal = document.getElementById('edit-score-modal');
            const setupForm = document.getElementById('setup-form');
            const playerNamesInput = document.getElementById('player-names');
            const roundsContainer = document.getElementById('rounds-container');
            const addRoundBtn = document.getElementById('add-round-btn');
            const roundTemplate = document.getElementById('round-template');
            const playerLeaderboard = document.getElementById('player-leaderboard');
            const scrollLeftBtn = document.getElementById('scroll-left-btn');
            const scrollRightBtn = document.getElementById('scroll-right-btn');
            const roundDisplay = document.getElementById('round-display');
            const topicDisplay = document.getElementById('topic-display');
            const mainBoard = document.getElementById('main-board');
            const undoBtn = document.getElementById('undo-btn');
            const revealAllBtn = document.getElementById('reveal-all-btn');
            const nextRoundBtn = document.getElementById('next-round-btn');
            const endGameBtn = document.getElementById('end-game-btn');
            const winnerAnnouncement = document.getElementById('winner-announcement');
            const finalScoresList = document.getElementById('final-scores-list');
            const playAgainBtn = document.getElementById('play-again-btn');
            const awardPlayerSelect = document.getElementById('award-player-select');
            const confirmAwardBtn = document.getElementById('confirm-award-btn');
            const cancelAwardBtn = document.getElementById('cancel-award-btn');
            const editScoreTitle = document.getElementById('edit-score-title');
            const editScoreInput = document.getElementById('edit-score-input');
            const confirmEditBtn = document.getElementById('confirm-edit-btn');
            const cancelEditBtn = document.getElementById('cancel-edit-btn');
            const sfx = { correct: document.getElementById('sfx-correct'), reveal: document.getElementById('sfx-reveal'), undo: document.getElementById('sfx-undo') };

            // --- TEMPLATE DATA ---
            const templateRounds = [
                { topic: "Apa aktivitas pertama yang biasa dilakukan oleh karyawan saat tiba di kantor?", answers: [{ text: "Menyalakan Laptop", points: 50 }, { text: "Menyapa Teman Kantor", points: 40 }, { text: "Cek HP", points: 30 }, { text: "Ngobrol", points: 20 }, { text: "Minum", points: 10 }, { text: "Rapikan Meja", points: 5 }] },
                { topic: "Hal apa saja yang biasanya membuat karyawan senang", answers: [{ text: "Gajian", points: 50 }, { text: "Cuti", points: 40 }, { text: "Pulang On Time", points: 30 }, { text: "Punya Team yang Menyenangkan", points: 20 }, { text: "Makanan Gratis", points: 10 }, { text: "Dapat Pujian", points: 5 }] },
                { topic: "Alasan paling umum telat masuk kantor?", answers: [{ text: "Macet", points: 50 }, { text: "Bangun Kesiangan", points: 40 }, { text: "Hujan Deras/Banjir", points: 30 }, { text: "Antar Anak Sekolah", points: 20 }, { text: "Sakit", points: 10 }, { text: "Ban Bocor", points: 5 }] },
                { topic: "Benda yang sering hilang di meja kerja?", answers: [{ text: "Alat Tulis", points: 50 }, { text: "Gunting/Cutter", points: 40 }, { text: "Stapler", points: 30 }, { text: "Kabel Charger", points: 20 }, { text: "Sticky Notes/Post It", points: 10 }, { text: "Botol Minum/Tumblr", points: 5 }] },
                { topic: "Saat apa biasanya orang menutup mulutnya dengan tangan?", answers: [{ text: "Menguap", points: 50 }, { text: "Berbisik", points: 40 }, { text: "Batuk/Bersin", points: 30 }, { text: "Kaget", points: 20 }, { text: "Tertawa", points: 10 }, { text: "Menangis/Terharu", points: 5 }] }
            ];

            // --- CORE FUNCTIONS ---
            function playSound(sound) {
                sound.currentTime = 0;
                sound.play().catch(e => console.log("Audio play failed:", e));
            }

            function switchScreen(screenName) {
                Object.values(screens).forEach(screen => screen.classList.remove('active'));
                screens[screenName].classList.add('active');
            }

            function toggleModal(modal, show) {
                modal.classList.toggle('active', show);
            }

            // --- SETUP SCREEN LOGIC ---
            function addRound(roundData = null) {
                const templateContent = roundTemplate.content.cloneNode(true);
                const roundEditor = templateContent.querySelector('.round-editor');
                const answersEditor = roundEditor.querySelector('.answers-editor');
                if (roundData) {
                    roundEditor.querySelector('.round-topic').value = roundData.topic;
                }
                for (let i = 0; i < 8; i++) {
                    const answer = roundData?.answers[i];
                    const answerInput = document.createElement('input');
                    answerInput.type = 'text';
                    answerInput.className = 'answer-input';
                    answerInput.placeholder = `Jawaban ${i + 1}`;
                    answerInput.value = answer?.text || '';
                    const pointInput = document.createElement('input');
                    pointInput.type = 'number';
                    pointInput.className = 'point-input';
                    pointInput.placeholder = 'Poin';
                    pointInput.value = answer?.points || '';
                    answersEditor.appendChild(answerInput);
                    answersEditor.appendChild(pointInput);
                }
                roundEditor.querySelector('.delete-round-btn').addEventListener('click', () => roundEditor.remove());
                roundsContainer.appendChild(templateContent);
            }

            function populateDefaultRounds() {
                roundsContainer.innerHTML = '';
                templateRounds.forEach(round => addRound(round));
            }

            function handleFormSubmit(e) {
                e.preventDefault();
                const players = playerNamesInput.value.split('\n').map(name => name.trim()).filter(name => name !== '');
                if (players.length < 1) {
                    alert('Masukkan minimal 1 nama pemain yang valid.');
                    return;
                }
                gameData = {
                    players: players.map(name => ({ name, score: 0 })),
                    rounds: [],
                    currentRoundIndex: 0,
                };

                const roundEditors = roundsContainer.querySelectorAll('.round-editor');
                roundEditors.forEach(editor => {
                    const topic = editor.querySelector('.round-topic').value;
                    const answers = [];
                    const answerInputs = editor.querySelectorAll('.answer-input');
                    const pointInputs = editor.querySelectorAll('.point-input');
                    answerInputs.forEach((input, index) => {
                        if (input.value.trim() !== '' && pointInputs[index].value.trim() !== '') {
                            answers.push({
                                text: input.value,
                                points: parseInt(pointInputs[index].value, 10),
                                revealed: false,
                            });
                        }
                    });
                    if (topic && answers.length > 0) {
                        gameData.rounds.push({ topic, answers });
                    }
                });

                if (gameData.rounds.length === 0) {
                    alert('Harap tambahkan minimal satu ronde dengan jawaban yang valid!');
                    return;
                }
                startGame();
            }

            // --- GAME LOGIC ---
            function startGame() {
                loadRound(0);
                switchScreen('game');
            }

            function loadRound(roundIndex) {
                if (roundIndex >= gameData.rounds.length) {
                    endGame();
                    return;
                }
                gameData.currentRoundIndex = roundIndex;
                const roundData = gameData.rounds[roundIndex];
                roundData.answers.forEach(a => a.revealed = false);

                mainBoard.innerHTML = '';
                roundDisplay.textContent = `RONDE ${roundIndex + 1}`;
                topicDisplay.textContent = roundData.topic;
                updateLeaderboard();

                lastAction = null; // Reset undo state
                undoBtn.style.display = 'none';

                roundData.answers.forEach((answer, index) => {
                    const slot = document.createElement('div');
                    slot.className = 'answer-slot';
                    slot.dataset.index = index;
                    slot.innerHTML = `
                    <div class="answer-slot-inner">
                        <div class="answer-front"><span class="answer-number">${index + 1}</span></div>
                        <div class="answer-back">
                            <span class="answer-text">${answer.text}</span>
                            <span class="answer-points">${answer.points}</span>
                        </div>
                    </div>`;
                    slot.addEventListener('click', () => handleAnswerClick(slot, index));
                    mainBoard.appendChild(slot);
                });
            }

            function handleAnswerClick(slot, answerIndex) {
                const roundData = gameData.rounds[gameData.currentRoundIndex];
                const answer = roundData.answers[answerIndex];
                if (answer.revealed) return;

                activeAward.answerSlot = slot;
                activeAward.answerIndex = answerIndex;
                activeAward.points = answer.points;

                awardPlayerSelect.innerHTML = '';
                gameData.players.forEach((player, index) => {
                    const option = document.createElement('option');
                    option.value = index;
                    option.textContent = player.name;
                    awardPlayerSelect.appendChild(option);
                });

                toggleModal(awardModal, true);
            }

            function awardPointsToPlayer() {
                const playerIndex = parseInt(awardPlayerSelect.value, 10);
                if (isNaN(playerIndex)) return;

                lastAction = {
                    playerIndex: playerIndex,
                    points: activeAward.points,
                    answerIndex: activeAward.answerIndex,
                    answerSlot: activeAward.answerSlot
                };

                playSound(sfx.correct);

                gameData.players[playerIndex].score += activeAward.points;
                gameData.rounds[gameData.currentRoundIndex].answers[activeAward.answerIndex].revealed = true;

                activeAward.answerSlot.classList.add('revealed');
                updateLeaderboard(playerIndex);

                undoBtn.style.display = 'inline-block';
                toggleModal(awardModal, false);
            }

            function handleUndo() {
                if (!lastAction) return;

                playSound(sfx.undo);

                gameData.players[lastAction.playerIndex].score -= lastAction.points;
                gameData.rounds[gameData.currentRoundIndex].answers[lastAction.answerIndex].revealed = false;

                lastAction.answerSlot.classList.remove('revealed');
                updateLeaderboard();

                lastAction = null;
                undoBtn.style.display = 'none';
            }

            function handleRevealAll() {
                const roundData = gameData.rounds[gameData.currentRoundIndex];
                mainBoard.querySelectorAll('.answer-slot').forEach((slot, index) => {
                    if (!roundData.answers[index].revealed) {
                        playSound(sfx.reveal);
                        slot.classList.add('revealed');
                        roundData.answers[index].revealed = true;
                    }
                });
                lastAction = null;
                undoBtn.style.display = 'none';
            }

            function handleNextRound() {
                loadRound(gameData.currentRoundIndex + 1);
            }

            function endGame() {
            const sortedPlayers = [...gameData.players].sort((a, b) => b.score - a.score);
            
            if (sortedPlayers.length > 0 && sortedPlayers[0].score > 0) {
                 winnerAnnouncement.textContent = `Pemenangnya adalah ${sortedPlayers[0].name}!`;
            } else {
                 winnerAnnouncement.textContent = `Tidak ada pemenang kali ini!`;
            }

            finalScoresList.innerHTML = '';
            sortedPlayers.forEach((player, index) => {
                const li = document.createElement('li');
                li.innerHTML = `<span>${index + 1}. ${player.name}</span> <strong>${player.score}</strong>`;
                finalScoresList.appendChild(li);
            });

            switchScreen('winner');
        }
// Pastikan event listener terpasang dengan benar
endGameBtn.addEventListener('click', () => {
    console.log('End game button clicked'); // Untuk debugging
    endGame();
});
            function resetGame() {
                playerNamesInput.value = '';
                populateDefaultRounds();
                switchScreen('setup');
            }

            // --- UI UPDATE & MANUAL EDIT FUNCTIONS ---
            function openEditScoreModal(playerIndex) {
                playerToEdit = playerIndex;
                const player = gameData.players[playerIndex];
                editScoreTitle.textContent = `Edit Skor ${player.name}`;
                editScoreInput.value = player.score;
                toggleModal(editScoreModal, true);
            }

            function confirmScoreEdit() {
                const newScore = parseInt(editScoreInput.value, 10);
                if (playerToEdit !== null && !isNaN(newScore)) {
                    gameData.players[playerToEdit].score = newScore;
                    updateLeaderboard();
                }
                toggleModal(editScoreModal, false);
                playerToEdit = null;
            }

            function updateScrollButtons() {
                setTimeout(() => {
                    const isScrollable = playerLeaderboard.scrollWidth > playerLeaderboard.clientWidth;
                    scrollLeftBtn.style.display = isScrollable && playerLeaderboard.scrollLeft > 5 ? 'block' : 'none';
                    const maxScrollLeft = playerLeaderboard.scrollWidth - playerLeaderboard.clientWidth;
                    scrollRightBtn.style.display = isScrollable && playerLeaderboard.scrollLeft < maxScrollLeft - 5 ? 'block' : 'none';
                }, 100);
            }

            function updateLeaderboard(highlightedPlayerIndex = -1) {
                playerLeaderboard.innerHTML = '';
                const sortedPlayers = [...gameData.players].sort((a, b) => b.score - a.score);

                sortedPlayers.forEach((player, rankIndex) => {
                    const originalIndex = gameData.players.findIndex(p => p.name === player.name);
                    const card = document.createElement('div');
                    card.className = 'player-card';

                    if (rankIndex === 0 && player.score > 0) card.classList.add('rank-1');
                    else if (rankIndex === 1 && player.score > 0) card.classList.add('rank-2');
                    else if (rankIndex === 2 && player.score > 0) card.classList.add('rank-3');
                    else if (gameData.players.length > 3) card.classList.add('rank-other');

                    if (originalIndex === highlightedPlayerIndex) {
                        card.classList.add('highlight');
                        setTimeout(() => card.classList.remove('highlight'), 1500);
                    }

                    let rankHTML = '';
                    if (rankIndex === 0 && player.score > 0) rankHTML = '<span class="player-rank">🥇</span>';
                    else if (rankIndex === 1 && player.score > 0) rankHTML = '<span class="player-rank">🥈</span>';
                    else if (rankIndex === 2 && player.score > 0) rankHTML = '<span class="player-rank">🥉</span>';

                    card.innerHTML = `${rankHTML}<span class="player-name">${player.name}</span> <span class="player-score" data-player-index="${originalIndex}">${player.score}</span>`;
                    playerLeaderboard.appendChild(card);
                });

                playerLeaderboard.querySelectorAll('.player-score').forEach(scoreEl => {
                    scoreEl.addEventListener('click', (e) => {
                        const playerIndex = parseInt(e.currentTarget.dataset.playerIndex, 10);
                        openEditScoreModal(playerIndex);
                    });
                });

                updateScrollButtons();
            }

            // --- EVENT LISTENERS ---
            addRoundBtn.addEventListener('click', () => addRound());
            setupForm.addEventListener('submit', handleFormSubmit);
            undoBtn.addEventListener('click', handleUndo);
            revealAllBtn.addEventListener('click', handleRevealAll);
            nextRoundBtn.addEventListener('click', handleNextRound);
            endGameBtn.addEventListener('click', endGame);
            playAgainBtn.addEventListener('click', resetGame);

            confirmAwardBtn.addEventListener('click', awardPointsToPlayer);
            cancelAwardBtn.addEventListener('click', () => toggleModal(awardModal, false));

            confirmEditBtn.addEventListener('click', confirmScoreEdit);
            cancelEditBtn.addEventListener('click', () => toggleModal(editScoreModal, false));

            scrollLeftBtn.addEventListener('click', () => { playerLeaderboard.scrollBy({ left: -300, behavior: 'smooth' }); });
            scrollRightBtn.addEventListener('click', () => { playerLeaderboard.scrollBy({ left: 300, behavior: 'smooth' }); });
            playerLeaderboard.addEventListener('scroll', updateScrollButtons);
            window.addEventListener('resize', updateScrollButtons);


            // --- INITIALIZATION ---
            populateDefaultRounds();
            playerNamesInput.value = "Priscilla \nSepthimoranie \nPris \nSepthi \nCilla \nRani";
        });
    </script>
</body>

</html>


